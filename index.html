<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>드랍쉬핑 CS 유입 현황</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+KR:wght@300;400;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Noto Sans KR', 'Inter', sans-serif;
            background: #f0f2f5;
            color: #1a2332;
            min-height: 100vh;
        }

        /* 헤더 */
        .dashboard-header {
            background: #1a2332;
            color: white;
            padding: 18px 32px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .dashboard-header h1 {
            font-size: 20px;
            font-weight: 600;
            letter-spacing: -0.3px;
        }
        .header-meta {
            font-size: 13px;
            color: rgba(255,255,255,0.65);
            display: flex;
            gap: 12px;
            align-items: center;
        }
        .header-meta span { display: flex; align-items: center; gap: 4px; }
        .header-meta .divider { color: rgba(255,255,255,0.3); }

        /* 컨텐츠 */
        .content {
            padding: 28px 32px;
            max-width: 1400px;
            margin: 0 auto;
        }

        /* KPI 카드 */
        .kpi-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 14px;
            margin-bottom: 24px;
        }
        .kpi-card {
            background: white;
            border-radius: 10px;
            padding: 20px 18px;
            border: 1px solid #e5e9f0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            transition: box-shadow 0.2s;
        }
        .kpi-card:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .kpi-label {
            font-size: 12px;
            color: #8292a4;
            font-weight: 500;
            margin-bottom: 8px;
        }
        .kpi-value {
            font-size: 30px;
            font-weight: 700;
            line-height: 1;
            letter-spacing: -1px;
        }
        .kpi-value.total   { color: #1a2332; }
        .kpi-value.wire    { color: #3b82f6; }
        .kpi-value.board   { color: #f59e0b; }
        .kpi-value.channel { color: #8b5cf6; }
        .kpi-value.peak    { color: #10b981; }
        .kpi-value.avg     { color: #6b7280; }
        .kpi-sub {
            font-size: 11px;
            color: #b0bec5;
            margin-top: 6px;
        }

        /* 차트 섹션 */
        .chart-section {
            background: white;
            border-radius: 10px;
            border: 1px solid #e5e9f0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.05);
            padding: 24px;
            margin-bottom: 20px;
        }
        .chart-title {
            font-size: 15px;
            font-weight: 600;
            color: #1a2332;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .chart-title::before {
            content: '';
            display: block;
            width: 3px;
            height: 16px;
            border-radius: 2px;
            background: #3b82f6;
        }
        .chart-wrap {
            position: relative;
            height: 280px;
        }

        /* 범례 커스텀 */
        .legend-row {
            display: flex;
            gap: 20px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 12px;
            color: #5a6a7e;
            font-weight: 500;
        }
        .legend-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }
        .legend-line {
            width: 20px;
            height: 3px;
            border-radius: 2px;
        }

        /* 데이터 기준 안내 */
        .data-note {
            font-size: 12px;
            color: #9aa5b4;
            margin-top: 10px;
            text-align: right;
        }

        /* 2열 차트 */
        .chart-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
    </style>
</head>
<body>

<div class="dashboard-header">
    <h1>드랍쉬핑 CS 유입 현황</h1>
    <div class="header-meta">
        <span>2026.02</span>
        <span class="divider">|</span>
        <span>시트: CS유입</span>
        <span class="divider">|</span>
        <span>유선 · 게시판 · 채널톡 기준</span>
    </div>
</div>

<div class="content">

    <!-- KPI 카드 -->
    <div class="kpi-grid">
        <div class="kpi-card">
            <div class="kpi-label">2월 총 유입</div>
            <div class="kpi-value total" id="kpi-total">-</div>
            <div class="kpi-sub">유선+게시판+채널톡</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">유선</div>
            <div class="kpi-value wire" id="kpi-wire">-</div>
            <div class="kpi-sub">누적 <span id="kpi-wire-cum">-</span>건</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">게시판</div>
            <div class="kpi-value board" id="kpi-board">-</div>
            <div class="kpi-sub">누적 <span id="kpi-board-cum">-</span>건</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">채널톡</div>
            <div class="kpi-value channel" id="kpi-channel">-</div>
            <div class="kpi-sub">2월 합계</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">일별 최고 유입</div>
            <div class="kpi-value peak" id="kpi-peak">-</div>
            <div class="kpi-sub" id="kpi-peak-date">-</div>
        </div>
        <div class="kpi-card">
            <div class="kpi-label">일 평균 유입</div>
            <div class="kpi-value avg" id="kpi-avg">-</div>
            <div class="kpi-sub">업무일 기준</div>
        </div>
    </div>

    <!-- 일별 유입 추이 차트 -->
    <div class="chart-section">
        <div class="chart-title">일별 CS 유입 추이</div>
        <div class="legend-row">
            <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div> 유선</div>
            <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div> 게시판</div>
            <div class="legend-item"><div class="legend-dot" style="background:#8b5cf6"></div> 채널톡</div>
            <div class="legend-item"><div class="legend-line" style="background:#e2e8f0"></div> 합계</div>
        </div>
        <div class="chart-wrap">
            <canvas id="dailyChart"></canvas>
        </div>
        <div class="data-note">* 스크린샷 기준 데이터 (일부 날짜 미반영될 수 있음)</div>
    </div>

    <!-- 누적 + 채널별 비율 -->
    <div class="chart-row">
        <div class="chart-section">
            <div class="chart-title">채널별 누적 유입</div>
            <div class="legend-row">
                <div class="legend-item"><div class="legend-line" style="background:#3b82f6"></div> 유선(누적)</div>
                <div class="legend-item"><div class="legend-line" style="background:#f59e0b"></div> 게시판(누적)</div>
                <div class="legend-item"><div class="legend-line" style="background:#8b5cf6"></div> 채널톡(누적)</div>
            </div>
            <div class="chart-wrap">
                <canvas id="cumulativeChart"></canvas>
            </div>
        </div>
        <div class="chart-section">
            <div class="chart-title">채널별 구성 비율 (2월 합계)</div>
            <div class="chart-wrap" style="height:260px; display:flex; align-items:center; justify-content:center;">
                <canvas id="pieChart" style="max-height:240px; max-width:320px;"></canvas>
            </div>
        </div>
    </div>

</div>

<script>
// ===== 데이터 =====
// CS유입 시트 데이터 (스크린샷 기준 + 누적값 반영)
const rawData = [
    { date: '2/2',  wire: 0, board: 1, channel: 0 },
    { date: '2/4',  wire: 1, board: 2, channel: 0 },
    { date: '2/5',  wire: 1, board: 5, channel: 2 },
    { date: '2/6',  wire: 1, board: 3, channel: 1 },
    { date: '2/9',  wire: 0, board: 0, channel: 0 },
    { date: '2/10', wire: 0, board: 2, channel: 0 },
    { date: '2/11', wire: 0, board: 0, channel: 0 },
    { date: '2/12', wire: 0, board: 3, channel: 1 },
    { date: '2/13', wire: 1, board: 3, channel: 1 },
    { date: '2/19', wire: 1, board: 2, channel: 1 },
    { date: '2/20', wire: 0, board: 2, channel: 0 },
    { date: '2/23', wire: 2, board: 1, channel: 0 },
];

// 누적값 (시트의 누적 컬럼 기준)
const CUM_WIRE  = 8;
const CUM_BOARD = 29;

// ===== KPI 계산 =====
const totalWire    = rawData.reduce((s, d) => s + d.wire, 0);
const totalBoard   = rawData.reduce((s, d) => s + d.board, 0);
const totalChannel = rawData.reduce((s, d) => s + d.channel, 0);
const totalAll     = totalWire + totalBoard + totalChannel;

const dailyTotals = rawData.map(d => ({ date: d.date, total: d.wire + d.board + d.channel }));
const peakDay     = dailyTotals.reduce((a, b) => a.total >= b.total ? a : b);
const avgVal      = (totalAll / rawData.filter(d => (d.wire + d.board + d.channel) > 0).length).toFixed(1);

document.getElementById('kpi-total').textContent    = totalAll;
document.getElementById('kpi-wire').textContent     = totalWire;
document.getElementById('kpi-wire-cum').textContent = CUM_WIRE;
document.getElementById('kpi-board').textContent    = totalBoard;
document.getElementById('kpi-board-cum').textContent= CUM_BOARD;
document.getElementById('kpi-channel').textContent  = totalChannel;
document.getElementById('kpi-peak').textContent     = peakDay.total;
document.getElementById('kpi-peak-date').textContent= peakDay.date + ' 최고';
document.getElementById('kpi-avg').textContent      = avgVal;

// ===== 색상 =====
const COLOR_WIRE    = '#3b82f6';
const COLOR_BOARD   = '#f59e0b';
const COLOR_CHANNEL = '#8b5cf6';
const COLOR_TOTAL   = '#cbd5e1';

function makeGradient(ctx, color) {
    const g = ctx.createLinearGradient(0, 0, 0, 280);
    g.addColorStop(0, color + '55');
    g.addColorStop(1, color + '00');
    return g;
}

// ===== 일별 추이 차트 =====
const labels = rawData.map(d => d.date);

const dailyCtx = document.getElementById('dailyChart').getContext('2d');
new Chart(dailyCtx, {
    type: 'bar',
    data: {
        labels,
        datasets: [
            {
                type: 'bar',
                label: '합계',
                data: rawData.map(d => d.wire + d.board + d.channel),
                backgroundColor: 'rgba(203,213,225,0.4)',
                borderColor: 'transparent',
                borderRadius: 4,
                order: 3,
                yAxisID: 'y',
            },
            {
                type: 'line',
                label: '유선',
                data: rawData.map(d => d.wire),
                borderColor: COLOR_WIRE,
                backgroundColor: makeGradient(dailyCtx, COLOR_WIRE),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_WIRE,
                tension: 0.35,
                fill: true,
                order: 0,
                yAxisID: 'y',
            },
            {
                type: 'line',
                label: '게시판',
                data: rawData.map(d => d.board),
                borderColor: COLOR_BOARD,
                backgroundColor: makeGradient(dailyCtx, COLOR_BOARD),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_BOARD,
                tension: 0.35,
                fill: true,
                order: 1,
                yAxisID: 'y',
            },
            {
                type: 'line',
                label: '채널톡',
                data: rawData.map(d => d.channel),
                borderColor: COLOR_CHANNEL,
                backgroundColor: makeGradient(dailyCtx, COLOR_CHANNEL),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_CHANNEL,
                tension: 0.35,
                fill: true,
                order: 2,
                yAxisID: 'y',
            },
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: {
            legend: { display: false },
            tooltip: {
                callbacks: {
                    footer: (items) => {
                        const sum = items.filter(i => i.dataset.label !== '합계')
                                        .reduce((s, i) => s + i.parsed.y, 0);
                        return `합계: ${sum}건`;
                    }
                }
            }
        },
        scales: {
            x: { grid: { display: false }, ticks: { font: { size: 12 }, color: '#8292a4' } },
            y: { beginAtZero: true, max: 8, ticks: { stepSize: 2, font: { size: 12 }, color: '#8292a4' },
                 grid: { color: '#f0f2f5' } }
        }
    }
});

// ===== 누적 차트 =====
let cumWire = 0, cumBoard = 0, cumChannel = 0;
const cumData = rawData.map(d => {
    cumWire    += d.wire;
    cumBoard   += d.board;
    cumChannel += d.channel;
    return { wire: cumWire, board: cumBoard, channel: cumChannel };
});

const cumCtx = document.getElementById('cumulativeChart').getContext('2d');
new Chart(cumCtx, {
    type: 'line',
    data: {
        labels,
        datasets: [
            {
                label: '유선(누적)',
                data: cumData.map(d => d.wire),
                borderColor: COLOR_WIRE,
                backgroundColor: makeGradient(cumCtx, COLOR_WIRE),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_WIRE,
                tension: 0.35,
                fill: true,
            },
            {
                label: '게시판(누적)',
                data: cumData.map(d => d.board),
                borderColor: COLOR_BOARD,
                backgroundColor: makeGradient(cumCtx, COLOR_BOARD),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_BOARD,
                tension: 0.35,
                fill: true,
            },
            {
                label: '채널톡(누적)',
                data: cumData.map(d => d.channel),
                borderColor: COLOR_CHANNEL,
                backgroundColor: makeGradient(cumCtx, COLOR_CHANNEL),
                borderWidth: 2.5,
                pointRadius: 4,
                pointBackgroundColor: COLOR_CHANNEL,
                tension: 0.35,
                fill: true,
            },
        ]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: { legend: { display: false } },
        scales: {
            x: { grid: { display: false }, ticks: { font: { size: 12 }, color: '#8292a4' } },
            y: { beginAtZero: true, ticks: { font: { size: 12 }, color: '#8292a4' },
                 grid: { color: '#f0f2f5' } }
        }
    }
});

// ===== 파이 차트 =====
const pieCtx = document.getElementById('pieChart').getContext('2d');
new Chart(pieCtx, {
    type: 'doughnut',
    data: {
        labels: ['유선', '게시판', '채널톡'],
        datasets: [{
            data: [totalWire, totalBoard, totalChannel],
            backgroundColor: [COLOR_WIRE, COLOR_BOARD, COLOR_CHANNEL],
            borderWidth: 3,
            borderColor: '#fff',
            hoverOffset: 6,
        }]
    },
    options: {
        responsive: true,
        maintainAspectRatio: false,
        cutout: '60%',
        plugins: {
            legend: {
                position: 'bottom',
                labels: { font: { size: 12 }, color: '#5a6a7e', padding: 16,
                    generateLabels: (chart) => {
                        const data = chart.data;
                        return data.labels.map((label, i) => ({
                            text: `${label}  ${data.datasets[0].data[i]}건`,
                            fillStyle: data.datasets[0].backgroundColor[i],
                            hidden: false, index: i,
                        }));
                    }
                }
            },
            tooltip: {
                callbacks: {
                    label: (item) => {
                        const val = item.parsed;
                        const pct = ((val / totalAll) * 100).toFixed(1);
                        return ` ${item.label}: ${val}건 (${pct}%)`;
                    }
                }
            }
        }
    }
});
</script>
</body>
</html>
